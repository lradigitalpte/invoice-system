{% extends "base.html" %}

{% block title %}Record Payment - Invoicing System{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h1 class="card-title">Record Payment for Invoice {{ invoice.invoice_number }}</h1>
    </div>
    
    <div style="margin-bottom: 1.5rem; padding: 1rem; background-color: #ecf0f1; border-radius: 4px;">
        <p><strong>Client:</strong> {{ invoice.client.name }}</p>
        <p><strong>Invoice Total:</strong> ${{ "%.2f"|format(invoice.get_total()) }}</p>
        <p><strong>Already Paid:</strong> ${{ "%.2f"|format(invoice.get_paid_amount()) }}</p>
        <p><strong>Balance Due:</strong> ${{ "%.2f"|format(invoice.get_balance()) }}</p>
    </div>
    
    <form method="POST" action="">
        <div class="form-row">
            <div class="form-group">
                <label for="payment_date">Payment Date *</label>
                <input type="date" id="payment_date" name="payment_date" value="{{ now.strftime('%Y-%m-%d') }}" required>
            </div>
            <div class="form-group">
                <label for="amount">Amount Paid * ($)</label>
                <input type="number" id="amount" name="amount" step="0.01" placeholder="0.00" required>
            </div>
        </div>
        
        <div class="form-group">
            <label for="payment_method">Payment Method</label>
            <select id="payment_method" name="payment_method">
                <option value="cash">Cash</option>
                <option value="check">Check</option>
                <option value="transfer">Bank Transfer</option>
                <option value="card">Credit Card</option>
                <option value="other">Other</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="notes">Notes</label>
            <textarea id="notes" name="notes" placeholder="Reference number, check number, etc."></textarea>
        </div>
        
        <div style="margin-top: 1.5rem;">
            <button type="submit" class="btn btn-success">Record Payment</button>
            <a href="{{ url_for('invoices.view_invoice', invoice_id=invoice.id) }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const amountInput = document.getElementById('amount');
    const balanceDue = {{ "%.2f"|format(invoice.get_balance()) }};
    amountInput.placeholder = '$' + parseFloat(balanceDue).toFixed(2);
});
</script>
{% endblock %}
